@model LoginRegistrationMVC.Models.RegisterViewModel

@{
    ViewBag.Title = "Register";
}

<h2>Register</h2>
<div id="register-message" style="display: none;"></div>

<form id="register-form">
    @Html.AntiForgeryToken()
    <div>
        @Html.LabelFor(m => m.Email)
        @Html.TextBoxFor(m => m.Email)
        @Html.ValidationMessageFor(m => m.Email, "", new { @class = "error" })
    </div>
    <div>
        @Html.LabelFor(m => m.Password)
        @Html.PasswordFor(m => m.Password)
        @Html.ValidationMessageFor(m => m.Password, "", new { @class = "error" })
    </div>
    <div>
        @Html.LabelFor(m => m.ConfirmPassword)
        @Html.PasswordFor(m => m.ConfirmPassword)
        @Html.ValidationMessageFor(m => m.ConfirmPassword, "", new { @class = "error" })
    </div>
    <div>
        <input type="submit" value="Register" />
    </div>
</form>

@section Scripts {
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function () {
            $("#register-form").submit(function (e) {
                e.preventDefault();

                if ($(this).valid()) {
                    var formData = {
                        Email: $("#Email").val(),
                        Password: $("#Password").val(),
                        ConfirmPassword: $("#ConfirmPassword").val(),
                        __RequestVerificationToken: $("input[name='__RequestVerificationToken']").val()
                    };

                    $.ajax({
                        url: "@Url.Action("Register", "Account")",
                        type: "POST",
                        data: formData,
                        success: function (response) {
                            if (response.Success) {
                                $("#register-message").text(response.Message).css("color", "green").show();
                                setTimeout(function () {
                                    window.location.href = "@Url.Action("Login", "Account")";
                                }, 1000);
                            } else {
                                $("#register-message").text(response.Message).css("color", "red").show();
                            }
                        },
                        error: function (xhr) {
                            var errorMessage = xhr.responseText || "Registration failed.";
                            $("#register-message").text(errorMessage).css("color", "red").show();
                        }
                    });
                }
            });
        });
    </script>
}