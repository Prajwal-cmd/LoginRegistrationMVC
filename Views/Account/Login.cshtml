@model LoginRegistrationMVC.Models.LoginViewModel

@{
    ViewBag.Title = "Login";
}

<h2>Login</h2>
<div id="login-message" style="display: none;"></div>

<form id="login-form">
    @Html.AntiForgeryToken()
    <div>
        @Html.LabelFor(m => m.Email)
        @Html.TextBoxFor(m => m.Email)
        @Html.ValidationMessageFor(m => m.Email, "", new { @class = "error" })
    </div>
    <div>
        @Html.LabelFor(m => m.Password)
        @Html.PasswordFor(m => m.Password)
        @Html.ValidationMessageFor(m => m.Password, "", new { @class = "error" })
    </div>
    <div>
        <input type="submit" value="Login" />
    </div>
</form>

@section Scripts {
    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/jqueryval")
    <script>
        $(document).ready(function () {
            $("#login-form").submit(function (e) {
                e.preventDefault();

                if ($(this).valid()) {
                    var formData = {
                        Email: $("#Email").val(),
                        Password: $("#Password").val(),
                        __RequestVerificationToken: $("input[name='__RequestVerificationToken']").val()
                    };

                    $.ajax({
                        url: "@Url.Action("Login", "Account")",
                        type: "POST",
                        data: formData,
                        success: function (response) {
                            if (response.Success) {
                                $("#login-message").text(response.Message).css("color", "green").show();
                                setTimeout(function () {
                                    window.location.href = "@Url.Action("Index", "Home")";
                                }, 1000);
                            } else {
                                $("#login-message").text(response.Message).css("color", "red").show();
                            }
                        },
                        error: function (xhr) {
                            var errorMessage = xhr.responseText || "Login failed.";
                            $("#login-message").text(errorMessage).css("color", "red").show();
                        }
                    });
                }
            });
        });
    </script>
}